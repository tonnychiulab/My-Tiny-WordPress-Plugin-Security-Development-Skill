# 🎓 WordPress 外掛安全防禦術：新手村指南 (LEARN.md)

嗨！歡迎來到你的 WordPress 外掛安全防禦道場。這份文件是特別為你準備的，我們不用艱澀的技術術語，而是用最直白、有趣的方式，帶你領略這套「防禦術」的精髓。

想像一下，你正在建造一座城堡（你的 WordPress 外掛），而這份 `LEARN.md` 就是你的建築藍圖與防禦指南。

---

## 🏰 這是什麼專案？為什麼需要它？

簡單來說，這個專案是一本**「防駭客教科書」**。

在網路世界裡，有很多壞人（駭客）想方設法要攻破你的城堡。他們可能會：
- 假扮成國王發號施令（權限漏洞）
- 在你的城牆上塗鴉亂寫（XSS 攻擊）
- 騙守衛把城門打開接納木馬（SQL 注入）

這個專案的目的，就是教你如何把城牆蓋得固若金湯，讓這些攻擊通通無效。我們整理了最常見的攻擊手法，並提供了對應的「防禦咒語」（程式碼範例）。

---

## 🗺️ 專案地圖：尋找失落的秘笈

這個專案的結構其實很簡單，但我們在這個資料夾中發現了一個小秘密...

### 檔案結構現況

理論上，根據 `PROJECT_STRUCTURE.md` 的記載，這座圖書館應該長這樣：
- **README.md**: 圖書館的導覽手冊。
- **SKILL.md**: **鎮館之寶**，記載了所有絕世武功的秘笈。
- **WordPress-Security-Quick-Reference.md**: 隨身攜帶的小抄。

**但實際上，我們發現「鎮館之寶」`SKILL.md` 被藏起來了！** 😲

它不在大廳（根目錄），而是被藏在了一個隱密的地下室：`.agent/skills/SKILL.md`。至於那張「小抄」（Quick Reference），目前似乎遺失了。不過別擔心，`SKILL.md` 裡的內容已經足夠強大，涵蓋了所有我們需要的知識。

---

## ⚔️ 四大防禦心法 (核心技術)

在這個專案中，我們主要學習四種最強大的防禦心法。讓我用比喻來解釋它們：

### 1. 對抗「特洛伊木馬」：SQL Injection (SQL 注入)

**攻擊手法**：
駭客在輸入框裡不只打名字，還偷偷夾帶了對資料庫下令的指令。就像木馬屠城記一樣，你看似收下禮物，其實讓敵人進了城。

**防禦心法 (`$wpdb->prepare`)**：
這就像是我們有一個**「來自未來的掃描機」**。在任何東西進入城堡核心（資料庫）之前，我們先用這台機器掃描一遍，把所有危險的指令都「無效化」，只保留純粹的文字。
> **口訣**：永遠不要相信任何人輸入的東西，進資料庫前一定要 `prepare`！

### 2. 對抗「亂塗鴉」：XSS (跨站腳本攻擊)

**攻擊手法**：
駭客在留言板或個人簡介裡寫了一段程式碼（JavaScript）。當其他人看到這則留言時，那段程式碼就會自動執行，偷走他們的餅乾（Cookie）或個資。這就像有人在你的佈告欄上貼了一張會爆炸的符咒。

**防禦心法 (Escaping 轉義)**：
我們在顯示任何內容之前，都要先進行**「消毒」**。
- `esc_html()`：把程式碼變成純文字顯示出來（把符咒變成一張普通的圖畫）。
- `esc_attr()`：用在 HTML 屬性裡。
- `esc_url()`：確保網址是安全的。
> **口訣**：輸出什麼就要用對應的刷子（函數）刷乾淨！

### 3. 對抗「偽造聖旨」：CSRF (跨站請求偽造)

**攻擊手法**：
駭客做了一個假按鈕，騙你點擊。因為你已經登入了自己的網站，點下去的瞬間，你也許就不知不覺地把自己的文章刪光了。就像駭客趁你不注意，拿著你的印章蓋了「同意拆除城堡」的文件。

**防禦心法 (Nonces 亂數)**：
這是**「一次性的通關密語」**。每次你打開表單，網站都會給你一個只有當下有效的密碼（Nonce）。當你送出表單時，守衛會檢查這個密碼對不對、有沒有過期。駭客沒辦法猜到這個隨機產生的密碼，所以他的假聖旨就會失效。
> **口訣**：沒有通關密語（Nonce），守衛（伺服器）一律不放行！

### 4. 對抗「假冒國王」：Broken Access Control (權限控制失效)

**攻擊手法**：
一個普通士兵（訂閱者）試圖闖入國王的寢宮（管理員頁面），或者試圖發布命令。如果沒有檢查身分，他就得逞了。

**防禦心法 (`current_user_can`)**：
這就是**「身分證查驗」**。做任何重要事情（刪除、修改、發布）之前，一定要先問：「你有這個權限嗎？」
> **口訣**：不要以為他是好人就不查身分證，做每件事都要問 `current_user_can`！

---

## 🧠 優秀工程師的思考方式 (Best Practices)

從這個專案中，我們學到頂尖工程師是怎麼思考的：

1.  **「零信任」原則**：不要相信任何來自外部的輸入（使用者的表單、網址參數、甚至資料庫拿出來的東西）。預設它們都是有毒的，直到你親手清理過。
2.  **層層防護**：
    - 進門前先檢查（驗證 Validation）
    - 收下時先消毒（淨化 Sanitization）
    - 拿出來用時再包裝（轉義 Escaping）
3.  **使用現成的盾牌**：不要自己發明加密法或防禦邏輯。WordPress 已經提供了 `prepare()`, `nonce`, `current_user_can()` 這些經過千錘百鍊的盾牌，直接用就對了！

---

## 🚀 下一步

既然你已經掌握了這些心法，接下來我們在開發你的外掛時，我就會隨時提醒你：
「嘿！這裡是不是忘了用 `prepare`？」
「小心！這個輸出還沒 `escape` 喔！」

讓我們一起打造一座固若金湯的 WordPress 城堡吧！🛡️
